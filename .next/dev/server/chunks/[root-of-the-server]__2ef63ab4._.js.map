{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/lib/ocr-service.ts"],"sourcesContent":["// License Plate Recognition Service\n// This service provides OCR capabilities for extracting license plate numbers from images\n\n/**\n * Mock OCR Implementation\n * In production, integrate with one of these:\n * - EasyOCR (Python-based, supports 80+ languages)\n * - Tesseract OCR (Open source)\n * - Google Vision API\n * - AWS Rekognition\n * - Plate Recognizer API (specialized for license plates)\n */\n\ninterface OCRResult {\n  success: boolean\n  plateNumber?: string\n  confidence?: number\n  error?: string\n}\n\nexport async function extractPlateNumberFromImage(\n  imageData: string\n): Promise<OCRResult> {\n  try {\n    // In development/testing, use mock data\n    if (process.env.NODE_ENV === \"development\") {\n      // return mockExtractPlateNumber(imageData);\n    }\n\n    // Production: Call actual OCR service\n    // For this implementation, we'll use a simple pattern-based approach\n    return await performOCR(imageData)\n  } catch (error) {\n    console.error(\"[v0] OCR Error:\", error)\n    return {\n      success: false,\n      error: \"Failed to process image\",\n    }\n  }\n}\n\nasync function performOCR(imageData: string): Promise<OCRResult> {\n  const apiKey = process.env.PLATE_RECOGNIZER_API_KEY\n  if (!apiKey) {\n    console.error(\"PLATE_RECOGNIZER_API_KEY is not set.\")\n    return {\n      success: false,\n      error: \"API key not configured\",\n    }\n  }\n\n  // The API expects a base64 string without the data URL prefix\n  const base64Image = imageData.split(\",\")\n\n  try {\n    const response = await fetch(\"https://api.platerecognizer.com/v1/plate-reader/\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Token ${apiKey}`,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        upload: base64Image,\n        region: \"in\", // Specify the region for Indian license plates\n      }),\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json()\n      console.error(\"Plate Recognizer API Error:\", errorData)\n      return {\n        success: false,\n        error: `API request failed with status ${response.status}`,\n      }\n    }\n\n    const data = await response.json()\n\n    if (data.results && data.results.length > 0) {\n      const plate = data.results\n      return {\n        success: true,\n        plateNumber: plate.plate,\n        confidence: plate.score,\n      }\n    } else {\n      return {\n        success: false,\n        error: \"No license plate found\",\n      }\n    }\n  } catch (error) {\n    console.error(\"Error calling Plate Recognizer API:\", error)\n    return {\n      success: false,\n      error: \"Failed to connect to the OCR service\",\n    }\n  }\n}\n\nfunction mockExtractPlateNumber(imageData: string): OCRResult {\n  // Mock data for testing\n  // Indian license plate format: [2 letter state code][2 digit district code][1 letter category][4 digit number]\n  // Example: KA01AB1234\n\n  const mockPlates = [\"KA01AB1234\", \"KA01CD5678\", \"MH02EF9012\", \"DL03GH3456\", \"TN04IJ7890\"]\n\n  const randomPlate = mockPlates[Math.floor(Math.random() * mockPlates.length)]\n\n  // Simulate OCR confidence (higher is better)\n  const confidence = 0.85 + Math.random() * 0.15 // 85-100%\n\n  return {\n    success: true,\n    plateNumber: randomPlate,\n    confidence,\n  }\n}\n\n/**\n * Validate License Plate Format\n * Indian License Plate Format: [State Code][District Code][Category][Serial Number]\n * Example: KA01AB1234\n */\nexport function validatePlateFormat(plateNumber: string): boolean {\n  // Indian format: 2 letters + 2 digits + 1-2 letters + 4 digits\n  const indianFormat = /^[A-Z]{2}\\d{2}[A-Z]{1,2}\\d{4}$/\n  return indianFormat.test(plateNumber.toUpperCase())\n}\n\n/**\n * Clean and normalize plate number\n */\nexport function normalizePlateNumber(plateNumber: string): string {\n  return plateNumber\n    .toUpperCase()\n    .replace(/\\s+/g, \"\") // Remove spaces\n    .replace(/[^A-Z0-9]/g, \"\") // Remove special characters\n}\n\n/**\n * Extract and validate plate number from OCR result\n */\nexport function extractValidPlate(ocrResult: OCRResult): string | null {\n  if (!ocrResult.success || !ocrResult.plateNumber) {\n    return null\n  }\n\n  const normalized = normalizePlateNumber(ocrResult.plateNumber)\n\n  if (validatePlateFormat(normalized)) {\n    return normalized\n  }\n\n  return null\n}\n"],"names":[],"mappings":"AAAA,oCAAoC;AACpC,0FAA0F;AAE1F;;;;;;;;CAQC;;;;;;;;;;AASM,eAAe,4BACpB,SAAiB;IAEjB,IAAI;QACF,wCAAwC;QACxC,IAAI,oDAAyB,eAAe;QAC1C,4CAA4C;QAC9C;QAEA,sCAAsC;QACtC,qEAAqE;QACrE,OAAO,MAAM,WAAW;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAEA,eAAe,WAAW,SAAiB;IACzC,MAAM,SAAS,QAAQ,GAAG,CAAC,wBAAwB;IACnD,IAAI,CAAC,QAAQ;QACX,QAAQ,KAAK,CAAC;QACd,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;IAEA,8DAA8D;IAC9D,MAAM,cAAc,UAAU,KAAK,CAAC;IAEpC,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,oDAAoD;YAC/E,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,MAAM,EAAE,QAAQ;gBAClC,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,QAAQ;gBACR,QAAQ;YACV;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,+BAA+B;YAC7C,OAAO;gBACL,SAAS;gBACT,OAAO,CAAC,+BAA+B,EAAE,SAAS,MAAM,EAAE;YAC5D;QACF;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,KAAK,OAAO,IAAI,KAAK,OAAO,CAAC,MAAM,GAAG,GAAG;YAC3C,MAAM,QAAQ,KAAK,OAAO;YAC1B,OAAO;gBACL,SAAS;gBACT,aAAa,MAAM,KAAK;gBACxB,YAAY,MAAM,KAAK;YACzB;QACF,OAAO;YACL,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAEA,SAAS,uBAAuB,SAAiB;IAC/C,wBAAwB;IACxB,+GAA+G;IAC/G,sBAAsB;IAEtB,MAAM,aAAa;QAAC;QAAc;QAAc;QAAc;QAAc;KAAa;IAEzF,MAAM,cAAc,UAAU,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,WAAW,MAAM,EAAE;IAE7E,6CAA6C;IAC7C,MAAM,aAAa,OAAO,KAAK,MAAM,KAAK,KAAK,UAAU;;IAEzD,OAAO;QACL,SAAS;QACT,aAAa;QACb;IACF;AACF;AAOO,SAAS,oBAAoB,WAAmB;IACrD,+DAA+D;IAC/D,MAAM,eAAe;IACrB,OAAO,aAAa,IAAI,CAAC,YAAY,WAAW;AAClD;AAKO,SAAS,qBAAqB,WAAmB;IACtD,OAAO,YACJ,WAAW,GACX,OAAO,CAAC,QAAQ,IAAI,gBAAgB;KACpC,OAAO,CAAC,cAAc,IAAI,4BAA4B;;AAC3D;AAKO,SAAS,kBAAkB,SAAoB;IACpD,IAAI,CAAC,UAAU,OAAO,IAAI,CAAC,UAAU,WAAW,EAAE;QAChD,OAAO;IACT;IAEA,MAAM,aAAa,qBAAqB,UAAU,WAAW;IAE7D,IAAI,oBAAoB,aAAa;QACnC,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 187, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, Db } from \"mongodb\";\n\nconst uri = process.env.MONGODB_URI!;\nconst dbName = process.env.MONGODB_DB_NAME || \"parking_meter\";\n\nlet client: MongoClient | null = null;\nlet db: Db | null = null;\n\nexport async function connectToDatabase() {\n  if (db && client) return { client, db };\n\n  if (!uri) {\n    throw new Error(\"MONGODB_URI is not set\");\n  }\n\n  client = new MongoClient(uri);\n  await client.connect();\n  db = client.db(dbName);\n  return { client, db };\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe,IAAI;AAE9C,IAAI,SAA6B;AACjC,IAAI,KAAgB;AAEb,eAAe;IACpB,IAAI,MAAM,QAAQ,OAAO;QAAE;QAAQ;IAAG;IAEtC;;IAIA,SAAS,IAAI,sHAAW,CAAC;IACzB,MAAM,OAAO,OAAO;IACpB,KAAK,OAAO,EAAE,CAAC;IACf,OAAO;QAAE;QAAQ;IAAG;AACtB"}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/app/api/scan/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { extractPlateNumberFromImage, extractValidPlate } from \"@/lib/ocr-service\"\nimport { connectToDatabase } from \"@/lib/mongodb\"\n\ninterface StudentVehicle {\n  _id?: string\n  studentName: string\n  usn: string\n  hostelRoom: string\n  vehicleNumber: string\n  licensePlateImage: string\n  registrationDate: Date\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { licensePlateImage } = body\n\n    if (!licensePlateImage) {\n      console.log(\"[v1] No image provided for scanning\")\n      return NextResponse.json({ error: \"No image provided\" }, { status: 400 })\n    }\n\n    console.log(\"[v1] Processing license plate scan...\")\n\n    // Extract plate number using OCR\n    const ocrResult = await extractPlateNumberFromImage(licensePlateImage)\n\n    if (!ocrResult.success) {\n      console.log(\"[v1] OCR processing failed:\", ocrResult.error)\n      return NextResponse.json({\n        success: false,\n        error: \"Failed to process image\",\n        found: false,\n      })\n    }\n\n    const extractedPlate = extractValidPlate(ocrResult)\n\n    if (!extractedPlate) {\n      console.log(\"[v1] Could not extract valid plate from OCR result\")\n      return NextResponse.json({\n        success: true,\n        found: false,\n        message: \"Could not extract valid plate number from image\",\n      })\n    }\n\n    console.log(\n      `[v1] Extracted Plate: ${extractedPlate}, Confidence: ${ocrResult.confidence?.toFixed(\n        2\n      )}%`\n    )\n\n    // Search for vehicle in database\n    const { db } = await connectToDatabase()\n    const student = await db.collection(\"vehicles\").findOne({\n      vehicleNumber: extractedPlate,\n    })\n\n    if (student) {\n      console.log(\"[v1] Vehicle found in database:\", extractedPlate)\n      return NextResponse.json({\n        success: true,\n        found: true,\n        student: {\n          studentName: student.studentName,\n          usn: student.usn,\n          hostelRoom: student.hostelRoom,\n          vehicleNumber: student.vehicleNumber,\n          registrationDate: student.registrationDate.toISOString(),\n        },\n        ocrConfidence: ocrResult.confidence,\n      })\n    } else {\n      console.log(\"[v1] Vehicle not found in database:\", extractedPlate)\n      return NextResponse.json({\n        success: true,\n        found: false,\n        message: \"Vehicle not registered in system\",\n        detectedPlate: extractedPlate,\n        ocrConfidence: ocrResult.confidence,\n      })\n    }\n  } catch (error) {\n    console.error(\"[v0] Scan error:\", error)\n    return NextResponse.json({ error: \"Failed to process scan\", success: false }, { status: 500 })\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({\n    message: \"License Plate Scanning API\",\n    method: \"POST\",\n    description: \"Scan a license plate to verify vehicle registration\",\n  })\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAYO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,iBAAiB,EAAE,GAAG;QAE9B,IAAI,CAAC,mBAAmB;YACtB,QAAQ,GAAG,CAAC;YACZ,OAAO,qNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,QAAQ,GAAG,CAAC;QAEZ,iCAAiC;QACjC,MAAM,YAAY,MAAM,IAAA,2NAA2B,EAAC;QAEpD,IAAI,CAAC,UAAU,OAAO,EAAE;YACtB,QAAQ,GAAG,CAAC,+BAA+B,UAAU,KAAK;YAC1D,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,OAAO;YACT;QACF;QAEA,MAAM,iBAAiB,IAAA,iNAAiB,EAAC;QAEzC,IAAI,CAAC,gBAAgB;YACnB,QAAQ,GAAG,CAAC;YACZ,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,SAAS;YACX;QACF;QAEA,QAAQ,GAAG,CACT,CAAC,sBAAsB,EAAE,eAAe,cAAc,EAAE,UAAU,UAAU,EAAE,QAC5E,GACA,CAAC,CAAC;QAGN,iCAAiC;QACjC,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,0MAAiB;QACtC,MAAM,UAAU,MAAM,GAAG,UAAU,CAAC,YAAY,OAAO,CAAC;YACtD,eAAe;QACjB;QAEA,IAAI,SAAS;YACX,QAAQ,GAAG,CAAC,mCAAmC;YAC/C,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,SAAS;oBACP,aAAa,QAAQ,WAAW;oBAChC,KAAK,QAAQ,GAAG;oBAChB,YAAY,QAAQ,UAAU;oBAC9B,eAAe,QAAQ,aAAa;oBACpC,kBAAkB,QAAQ,gBAAgB,CAAC,WAAW;gBACxD;gBACA,eAAe,UAAU,UAAU;YACrC;QACF,OAAO;YACL,QAAQ,GAAG,CAAC,uCAAuC;YACnD,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,SAAS;gBACT,eAAe;gBACf,eAAe,UAAU,UAAU;YACrC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA0B,SAAS;QAAM,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF;AAEO,eAAe;IACpB,OAAO,qNAAY,CAAC,IAAI,CAAC;QACvB,SAAS;QACT,QAAQ;QACR,aAAa;IACf;AACF"}}]
}