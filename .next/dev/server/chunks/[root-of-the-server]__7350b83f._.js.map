{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/lib/ocr-service.ts"],"sourcesContent":["// License Plate Recognition Service\n// This service provides OCR capabilities for extracting license plate numbers from images\n\n/**\n * Mock OCR Implementation\n * In production, integrate with one of these:\n * - EasyOCR (Python-based, supports 80+ languages)\n * - Tesseract OCR (Open source)\n * - Google Vision API\n * - AWS Rekognition\n * - Plate Recognizer API (specialized for license plates)\n */\n\ninterface OCRResult {\n  success: boolean\n  plateNumber?: string\n  confidence?: number\n  error?: string\n}\n\nexport async function extractPlateNumberFromImage(imageData: string): Promise<OCRResult> {\n  try {\n    // In development/testing, use mock data\n    if (process.env.NODE_ENV === \"development\") {\n      return mockExtractPlateNumber(imageData)\n    }\n\n    // Production: Call actual OCR service\n    // For this implementation, we'll use a simple pattern-based approach\n    return await performOCR(imageData)\n  } catch (error) {\n    console.error(\"[v0] OCR Error:\", error)\n    return {\n      success: false,\n      error: \"Failed to process image\",\n    }\n  }\n}\n\nasync function performOCR(imageData: string): Promise<OCRResult> {\n  // Convert base64 image to buffer if needed\n  // Extract text using OCR library\n\n  // Example with Tesseract (would require serverless deployment support)\n  // const { createWorker } = require('tesseract.js');\n  // const worker = await createWorker();\n  // const { data: { text } } = await worker.recognize(imageBuffer);\n  // await worker.terminate();\n\n  // For now, return mock data\n  return mockExtractPlateNumber(imageData)\n}\n\nfunction mockExtractPlateNumber(imageData: string): OCRResult {\n  // Mock data for testing\n  // Indian license plate format: [2 letter state code][2 digit district code][1 letter category][4 digit number]\n  // Example: KA01AB1234\n\n  const mockPlates = [\"KA01AB1234\", \"KA01CD5678\", \"MH02EF9012\", \"DL03GH3456\", \"TN04IJ7890\"]\n\n  const randomPlate = mockPlates[Math.floor(Math.random() * mockPlates.length)]\n\n  // Simulate OCR confidence (higher is better)\n  const confidence = 0.85 + Math.random() * 0.15 // 85-100%\n\n  return {\n    success: true,\n    plateNumber: randomPlate,\n    confidence,\n  }\n}\n\n/**\n * Validate License Plate Format\n * Indian License Plate Format: [State Code][District Code][Category][Serial Number]\n * Example: KA01AB1234\n */\nexport function validatePlateFormat(plateNumber: string): boolean {\n  // Indian format: 2 letters + 2 digits + 1-2 letters + 4 digits\n  const indianFormat = /^[A-Z]{2}\\d{2}[A-Z]{1,2}\\d{4}$/\n  return indianFormat.test(plateNumber.toUpperCase())\n}\n\n/**\n * Clean and normalize plate number\n */\nexport function normalizePlateNumber(plateNumber: string): string {\n  return plateNumber\n    .toUpperCase()\n    .replace(/\\s+/g, \"\") // Remove spaces\n    .replace(/[^A-Z0-9]/g, \"\") // Remove special characters\n}\n\n/**\n * Extract and validate plate number from OCR result\n */\nexport function extractValidPlate(ocrResult: OCRResult): string | null {\n  if (!ocrResult.success || !ocrResult.plateNumber) {\n    return null\n  }\n\n  const normalized = normalizePlateNumber(ocrResult.plateNumber)\n\n  if (validatePlateFormat(normalized)) {\n    return normalized\n  }\n\n  return null\n}\n"],"names":[],"mappings":"AAAA,oCAAoC;AACpC,0FAA0F;AAE1F;;;;;;;;CAQC;;;;;;;;;;AASM,eAAe,4BAA4B,SAAiB;IACjE,IAAI;QACF,wCAAwC;QACxC,wCAA4C;YAC1C,OAAO,uBAAuB;QAChC;;;IAKF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAEA,eAAe,WAAW,SAAiB;IACzC,2CAA2C;IAC3C,iCAAiC;IAEjC,uEAAuE;IACvE,oDAAoD;IACpD,uCAAuC;IACvC,kEAAkE;IAClE,4BAA4B;IAE5B,4BAA4B;IAC5B,OAAO,uBAAuB;AAChC;AAEA,SAAS,uBAAuB,SAAiB;IAC/C,wBAAwB;IACxB,+GAA+G;IAC/G,sBAAsB;IAEtB,MAAM,aAAa;QAAC;QAAc;QAAc;QAAc;QAAc;KAAa;IAEzF,MAAM,cAAc,UAAU,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,WAAW,MAAM,EAAE;IAE7E,6CAA6C;IAC7C,MAAM,aAAa,OAAO,KAAK,MAAM,KAAK,KAAK,UAAU;;IAEzD,OAAO;QACL,SAAS;QACT,aAAa;QACb;IACF;AACF;AAOO,SAAS,oBAAoB,WAAmB;IACrD,+DAA+D;IAC/D,MAAM,eAAe;IACrB,OAAO,aAAa,IAAI,CAAC,YAAY,WAAW;AAClD;AAKO,SAAS,qBAAqB,WAAmB;IACtD,OAAO,YACJ,WAAW,GACX,OAAO,CAAC,QAAQ,IAAI,gBAAgB;KACpC,OAAO,CAAC,cAAc,IAAI,4BAA4B;;AAC3D;AAKO,SAAS,kBAAkB,SAAoB;IACpD,IAAI,CAAC,UAAU,OAAO,IAAI,CAAC,UAAU,WAAW,EAAE;QAChD,OAAO;IACT;IAEA,MAAM,aAAa,qBAAqB,UAAU,WAAW;IAE7D,IAAI,oBAAoB,aAAa;QACnC,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/app/api/scan/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { extractPlateNumberFromImage, extractValidPlate } from \"@/lib/ocr-service\"\n\ninterface StudentVehicle {\n  _id?: string\n  studentName: string\n  usn: string\n  hostelRoom: string\n  vehicleNumber: string\n  licensePlateImage: string\n  registrationDate: Date\n}\n\n// Mock database (will be replaced with MongoDB)\nconst vehicleDatabase: StudentVehicle[] = [\n  {\n    _id: \"1\",\n    studentName: \"John Doe\",\n    usn: \"1BM19CS001\",\n    hostelRoom: \"A-201\",\n    vehicleNumber: \"KA01AB1234\",\n    licensePlateImage: \"\",\n    registrationDate: new Date(\"2025-01-15\"),\n  },\n  {\n    _id: \"2\",\n    studentName: \"Jane Smith\",\n    usn: \"1BM19CS002\",\n    hostelRoom: \"B-305\",\n    vehicleNumber: \"KA01CD5678\",\n    licensePlateImage: \"\",\n    registrationDate: new Date(\"2025-01-10\"),\n  },\n]\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { licensePlateImage } = body\n\n    if (!licensePlateImage) {\n      console.log(\"[v0] No image provided for scanning\")\n      return NextResponse.json({ error: \"No image provided\" }, { status: 400 })\n    }\n\n    console.log(\"[v0] Processing license plate scan...\")\n\n    // Extract plate number using OCR\n    const ocrResult = await extractPlateNumberFromImage(licensePlateImage)\n\n    if (!ocrResult.success) {\n      console.log(\"[v0] OCR processing failed:\", ocrResult.error)\n      return NextResponse.json({\n        success: false,\n        error: \"Failed to process image\",\n        found: false,\n      })\n    }\n\n    const extractedPlate = extractValidPlate(ocrResult)\n\n    if (!extractedPlate) {\n      console.log(\"[v0] Could not extract valid plate from OCR result\")\n      return NextResponse.json({\n        success: true,\n        found: false,\n        message: \"Could not extract valid plate number from image\",\n      })\n    }\n\n    console.log(\"[v0] Extracted plate number:\", extractedPlate, \"Confidence:\", ocrResult.confidence)\n\n    // Search for vehicle in database\n    const student = vehicleDatabase.find((v) => v.vehicleNumber === extractedPlate)\n\n    if (student) {\n      console.log(\"[v0] Vehicle found in database:\", extractedPlate)\n      return NextResponse.json({\n        success: true,\n        found: true,\n        student: {\n          studentName: student.studentName,\n          usn: student.usn,\n          hostelRoom: student.hostelRoom,\n          vehicleNumber: student.vehicleNumber,\n          registrationDate: student.registrationDate.toISOString(),\n        },\n        ocrConfidence: ocrResult.confidence,\n      })\n    } else {\n      console.log(\"[v0] Vehicle not found in database:\", extractedPlate)\n      return NextResponse.json({\n        success: true,\n        found: false,\n        message: \"Vehicle not registered in system\",\n        detectedPlate: extractedPlate,\n        ocrConfidence: ocrResult.confidence,\n      })\n    }\n  } catch (error) {\n    console.error(\"[v0] Scan error:\", error)\n    return NextResponse.json({ error: \"Failed to process scan\", success: false }, { status: 500 })\n  }\n}\n\nexport async function GET() {\n  return NextResponse.json({\n    message: \"License Plate Scanning API\",\n    method: \"POST\",\n    description: \"Scan a license plate to verify vehicle registration\",\n  })\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAYA,gDAAgD;AAChD,MAAM,kBAAoC;IACxC;QACE,KAAK;QACL,aAAa;QACb,KAAK;QACL,YAAY;QACZ,eAAe;QACf,mBAAmB;QACnB,kBAAkB,IAAI,KAAK;IAC7B;IACA;QACE,KAAK;QACL,aAAa;QACb,KAAK;QACL,YAAY;QACZ,eAAe;QACf,mBAAmB;QACnB,kBAAkB,IAAI,KAAK;IAC7B;CACD;AAEM,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,iBAAiB,EAAE,GAAG;QAE9B,IAAI,CAAC,mBAAmB;YACtB,QAAQ,GAAG,CAAC;YACZ,OAAO,qNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,QAAQ,GAAG,CAAC;QAEZ,iCAAiC;QACjC,MAAM,YAAY,MAAM,IAAA,2NAA2B,EAAC;QAEpD,IAAI,CAAC,UAAU,OAAO,EAAE;YACtB,QAAQ,GAAG,CAAC,+BAA+B,UAAU,KAAK;YAC1D,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,OAAO;YACT;QACF;QAEA,MAAM,iBAAiB,IAAA,iNAAiB,EAAC;QAEzC,IAAI,CAAC,gBAAgB;YACnB,QAAQ,GAAG,CAAC;YACZ,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,SAAS;YACX;QACF;QAEA,QAAQ,GAAG,CAAC,gCAAgC,gBAAgB,eAAe,UAAU,UAAU;QAE/F,iCAAiC;QACjC,MAAM,UAAU,gBAAgB,IAAI,CAAC,CAAC,IAAM,EAAE,aAAa,KAAK;QAEhE,IAAI,SAAS;YACX,QAAQ,GAAG,CAAC,mCAAmC;YAC/C,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,SAAS;oBACP,aAAa,QAAQ,WAAW;oBAChC,KAAK,QAAQ,GAAG;oBAChB,YAAY,QAAQ,UAAU;oBAC9B,eAAe,QAAQ,aAAa;oBACpC,kBAAkB,QAAQ,gBAAgB,CAAC,WAAW;gBACxD;gBACA,eAAe,UAAU,UAAU;YACrC;QACF,OAAO;YACL,QAAQ,GAAG,CAAC,uCAAuC;YACnD,OAAO,qNAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,SAAS;gBACT,eAAe;gBACf,eAAe,UAAU,UAAU;YACrC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAA0B,SAAS;QAAM,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF;AAEO,eAAe;IACpB,OAAO,qNAAY,CAAC,IAAI,CAAC;QACvB,SAAS;QACT,QAAQ;QACR,aAAa;IACf;AACF"}}]
}