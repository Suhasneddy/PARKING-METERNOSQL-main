{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/lib/ocr-service.ts"],"sourcesContent":["// License Plate Recognition Service\n// This service provides OCR capabilities for extracting license plate numbers from images\n\n/**\n * Mock OCR Implementation\n * In production, integrate with one of these:\n * - EasyOCR (Python-based, supports 80+ languages)\n * - Tesseract OCR (Open source)\n * - Google Vision API\n * - AWS Rekognition\n * - Plate Recognizer API (specialized for license plates)\n */\n\ninterface OCRResult {\n  success: boolean\n  plateNumber?: string\n  confidence?: number\n  error?: string\n}\n\nexport async function extractPlateNumberFromImage(imageData: string): Promise<OCRResult> {\n  try {\n    // In development/testing, use mock data\n    if (process.env.NODE_ENV === \"development\") {\n      return mockExtractPlateNumber(imageData)\n    }\n\n    // Production: Call actual OCR service\n    // For this implementation, we'll use a simple pattern-based approach\n    return await performOCR(imageData)\n  } catch (error) {\n    console.error(\"[v0] OCR Error:\", error)\n    return {\n      success: false,\n      error: \"Failed to process image\",\n    }\n  }\n}\n\nasync function performOCR(imageData: string): Promise<OCRResult> {\n  // Convert base64 image to buffer if needed\n  // Extract text using OCR library\n\n  // Example with Tesseract (would require serverless deployment support)\n  // const { createWorker } = require('tesseract.js');\n  // const worker = await createWorker();\n  // const { data: { text } } = await worker.recognize(imageBuffer);\n  // await worker.terminate();\n\n  // For now, return mock data\n  return mockExtractPlateNumber(imageData)\n}\n\nfunction mockExtractPlateNumber(imageData: string): OCRResult {\n  // Mock data for testing\n  // Indian license plate format: [2 letter state code][2 digit district code][1 letter category][4 digit number]\n  // Example: KA01AB1234\n\n  const mockPlates = [\"KA01AB1234\", \"KA01CD5678\", \"MH02EF9012\", \"DL03GH3456\", \"TN04IJ7890\"]\n\n  const randomPlate = mockPlates[Math.floor(Math.random() * mockPlates.length)]\n\n  // Simulate OCR confidence (higher is better)\n  const confidence = 0.85 + Math.random() * 0.15 // 85-100%\n\n  return {\n    success: true,\n    plateNumber: randomPlate,\n    confidence,\n  }\n}\n\n/**\n * Validate License Plate Format\n * Indian License Plate Format: [State Code][District Code][Category][Serial Number]\n * Example: KA01AB1234\n */\nexport function validatePlateFormat(plateNumber: string): boolean {\n  // Indian format: 2 letters + 2 digits + 1-2 letters + 4 digits\n  const indianFormat = /^[A-Z]{2}\\d{2}[A-Z]{1,2}\\d{4}$/\n  return indianFormat.test(plateNumber.toUpperCase())\n}\n\n/**\n * Clean and normalize plate number\n */\nexport function normalizePlateNumber(plateNumber: string): string {\n  return plateNumber\n    .toUpperCase()\n    .replace(/\\s+/g, \"\") // Remove spaces\n    .replace(/[^A-Z0-9]/g, \"\") // Remove special characters\n}\n\n/**\n * Extract and validate plate number from OCR result\n */\nexport function extractValidPlate(ocrResult: OCRResult): string | null {\n  if (!ocrResult.success || !ocrResult.plateNumber) {\n    return null\n  }\n\n  const normalized = normalizePlateNumber(ocrResult.plateNumber)\n\n  if (validatePlateFormat(normalized)) {\n    return normalized\n  }\n\n  return null\n}\n"],"names":[],"mappings":"AAAA,oCAAoC;AACpC,0FAA0F;AAE1F;;;;;;;;CAQC;;;;;;;;;;AASM,eAAe,4BAA4B,SAAiB;IACjE,IAAI;QACF,wCAAwC;QACxC,wCAA4C;YAC1C,OAAO,uBAAuB;QAChC;;;IAKF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAEA,eAAe,WAAW,SAAiB;IACzC,2CAA2C;IAC3C,iCAAiC;IAEjC,uEAAuE;IACvE,oDAAoD;IACpD,uCAAuC;IACvC,kEAAkE;IAClE,4BAA4B;IAE5B,4BAA4B;IAC5B,OAAO,uBAAuB;AAChC;AAEA,SAAS,uBAAuB,SAAiB;IAC/C,wBAAwB;IACxB,+GAA+G;IAC/G,sBAAsB;IAEtB,MAAM,aAAa;QAAC;QAAc;QAAc;QAAc;QAAc;KAAa;IAEzF,MAAM,cAAc,UAAU,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,WAAW,MAAM,EAAE;IAE7E,6CAA6C;IAC7C,MAAM,aAAa,OAAO,KAAK,MAAM,KAAK,KAAK,UAAU;;IAEzD,OAAO;QACL,SAAS;QACT,aAAa;QACb;IACF;AACF;AAOO,SAAS,oBAAoB,WAAmB;IACrD,+DAA+D;IAC/D,MAAM,eAAe;IACrB,OAAO,aAAa,IAAI,CAAC,YAAY,WAAW;AAClD;AAKO,SAAS,qBAAqB,WAAmB;IACtD,OAAO,YACJ,WAAW,GACX,OAAO,CAAC,QAAQ,IAAI,gBAAgB;KACpC,OAAO,CAAC,cAAc,IAAI,4BAA4B;;AAC3D;AAKO,SAAS,kBAAkB,SAAoB;IACpD,IAAI,CAAC,UAAU,OAAO,IAAI,CAAC,UAAU,WAAW,EAAE;QAChD,OAAO;IACT;IAEA,MAAM,aAAa,qBAAqB,UAAU,WAAW;IAE7D,IAAI,oBAAoB,aAAa;QACnC,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/lib/plate-validator.ts"],"sourcesContent":["// License Plate Validation Utilities\n\nexport interface PlateValidationResult {\n  isValid: boolean\n  errors: string[]\n  plateNumber?: string\n}\n\n/**\n * Comprehensive plate validation\n */\nexport function validatePlate(plateNumber: string): PlateValidationResult {\n  const errors: string[] = []\n  const normalized = normalizePlateNumber(plateNumber)\n\n  // Check format\n  if (!validateIndianFormat(normalized)) {\n    errors.push(\"Invalid Indian license plate format\")\n  }\n\n  // Check length\n  if (normalized.length !== 10) {\n    errors.push(\"License plate must be 10 characters (including state and district codes)\")\n  }\n\n  // Check state code validity\n  const stateCode = normalized.substring(0, 2)\n  if (!isValidStateCode(stateCode)) {\n    errors.push(`Invalid state code: ${stateCode}`)\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n    plateNumber: errors.length === 0 ? normalized : undefined,\n  }\n}\n\nfunction normalizePlateNumber(plate: string): string {\n  return plate\n    .toUpperCase()\n    .replace(/\\s+/g, \"\")\n    .replace(/[^A-Z0-9]/g, \"\")\n}\n\nfunction validateIndianFormat(plate: string): boolean {\n  // Indian format: 2 letters (state) + 2 digits (district) + 1-2 letters (category) + 4 digits (serial)\n  const pattern = /^[A-Z]{2}\\d{2}[A-Z]{1,2}\\d{4}$/\n  return pattern.test(plate)\n}\n\nfunction isValidStateCode(code: string): boolean {\n  // Valid Indian state codes\n  const validStates = [\n    \"AN\",\n    \"AP\",\n    \"AR\",\n    \"AS\",\n    \"BR\",\n    \"CG\",\n    \"CH\",\n    \"CT\",\n    \"DD\",\n    \"DL\",\n    \"DN\",\n    \"GA\",\n    \"GJ\",\n    \"HR\",\n    \"HP\",\n    \"JK\",\n    \"JH\",\n    \"KA\",\n    \"KL\",\n    \"LA\",\n    \"LD\",\n    \"MH\",\n    \"ML\",\n    \"MN\",\n    \"MP\",\n    \"MZ\",\n    \"NL\",\n    \"OR\",\n    \"OD\",\n    \"PB\",\n    \"PY\",\n    \"RJ\",\n    \"SK\",\n    \"TG\",\n    \"TR\",\n    \"TN\",\n    \"TR\",\n    \"UP\",\n    \"UT\",\n    \"UK\",\n    \"WB\",\n  ]\n  return validStates.includes(code.toUpperCase())\n}\n\n/**\n * Get state name from state code\n */\nexport function getStateName(stateCode: string): string | null {\n  const stateMap: Record<string, string> = {\n    AP: \"Andhra Pradesh\",\n    AR: \"Arunachal Pradesh\",\n    AS: \"Assam\",\n    BR: \"Bihar\",\n    CG: \"Chhattisgarh\",\n    CH: \"Chandigarh\",\n    CT: \"Chhattisgarh\",\n    DD: \"Daman and Diu\",\n    DL: \"Delhi\",\n    DN: \"Dadra and Nagar Haveli\",\n    GA: \"Goa\",\n    GJ: \"Gujarat\",\n    HR: \"Haryana\",\n    HP: \"Himachal Pradesh\",\n    JK: \"Jammu and Kashmir\",\n    JH: \"Jharkhand\",\n    KA: \"Karnataka\",\n    KL: \"Kerala\",\n    LA: \"Ladakh\",\n    MH: \"Maharashtra\",\n    ML: \"Meghalaya\",\n    MN: \"Manipur\",\n    MP: \"Madhya Pradesh\",\n    MZ: \"Mizoram\",\n    NL: \"Nagaland\",\n    OR: \"Odisha\",\n    OD: \"Odisha\",\n    PB: \"Punjab\",\n    PY: \"Puducherry\",\n    RJ: \"Rajasthan\",\n    SK: \"Sikkim\",\n    TG: \"Telangana\",\n    TN: \"Tamil Nadu\",\n    TR: \"Tripura\",\n    UP: \"Uttar Pradesh\",\n    UT: \"Uttarakhand\",\n    UK: \"Uttarakhand\",\n    WB: \"West Bengal\",\n  }\n  return stateMap[stateCode.toUpperCase()] || null\n}\n"],"names":[],"mappings":"AAAA,qCAAqC;;;;;;;AAW9B,SAAS,cAAc,WAAmB;IAC/C,MAAM,SAAmB,EAAE;IAC3B,MAAM,aAAa,qBAAqB;IAExC,eAAe;IACf,IAAI,CAAC,qBAAqB,aAAa;QACrC,OAAO,IAAI,CAAC;IACd;IAEA,eAAe;IACf,IAAI,WAAW,MAAM,KAAK,IAAI;QAC5B,OAAO,IAAI,CAAC;IACd;IAEA,4BAA4B;IAC5B,MAAM,YAAY,WAAW,SAAS,CAAC,GAAG;IAC1C,IAAI,CAAC,iBAAiB,YAAY;QAChC,OAAO,IAAI,CAAC,CAAC,oBAAoB,EAAE,WAAW;IAChD;IAEA,OAAO;QACL,SAAS,OAAO,MAAM,KAAK;QAC3B;QACA,aAAa,OAAO,MAAM,KAAK,IAAI,aAAa;IAClD;AACF;AAEA,SAAS,qBAAqB,KAAa;IACzC,OAAO,MACJ,WAAW,GACX,OAAO,CAAC,QAAQ,IAChB,OAAO,CAAC,cAAc;AAC3B;AAEA,SAAS,qBAAqB,KAAa;IACzC,sGAAsG;IACtG,MAAM,UAAU;IAChB,OAAO,QAAQ,IAAI,CAAC;AACtB;AAEA,SAAS,iBAAiB,IAAY;IACpC,2BAA2B;IAC3B,MAAM,cAAc;QAClB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,OAAO,YAAY,QAAQ,CAAC,KAAK,WAAW;AAC9C;AAKO,SAAS,aAAa,SAAiB;IAC5C,MAAM,WAAmC;QACvC,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;IACN;IACA,OAAO,QAAQ,CAAC,UAAU,WAAW,GAAG,IAAI;AAC9C"}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/lib/mongodb.ts"],"sourcesContent":["// lib/mongodb.ts\nimport { MongoClient, Db } from \"mongodb\";\n\nlet client: MongoClient;\nlet db: Db;\n\nif (!process.env.MONGODB_URI) {\n  throw new Error(\"❌ MONGODB_URI is missing. Add it to .env.local\");\n}\n\nconst uri = process.env.MONGODB_URI;\nconst dbName = uri.split(\"/\").pop()?.split(\"?\")[0] || \"parking_meter\";\n\nexport async function connectToDatabase() {\n  if (db) return { client, db };\n\n  client = new MongoClient(uri);\n  await client.connect();\n  db = client.db(dbName);\n\n  console.log(\"✅ Connected to MongoDB:\", dbName);\n  return { client, db };\n}\n"],"names":[],"mappings":"AAAA,iBAAiB;;;;;AACjB;;AAEA,IAAI;AACJ,IAAI;AAEJ,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,SAAS,IAAI,KAAK,CAAC,KAAK,GAAG,IAAI,MAAM,IAAI,CAAC,EAAE,IAAI;AAE/C,eAAe;IACpB,IAAI,IAAI,OAAO;QAAE;QAAQ;IAAG;IAE5B,SAAS,IAAI,sHAAW,CAAC;IACzB,MAAM,OAAO,OAAO;IACpB,KAAK,OAAO,EAAE,CAAC;IAEf,QAAQ,GAAG,CAAC,2BAA2B;IACvC,OAAO;QAAE;QAAQ;IAAG;AACtB"}},
    {"offset": {"line": 307, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/OneDrive/Documents/NO%20SQL/PARKING-METERNOSQL-main/app/api/register/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\";\r\nimport { normalizePlateNumber } from \"@/lib/ocr-service\";\r\nimport { validatePlate } from \"@/lib/plate-validator\";\r\nimport { connectToDatabase } from \"@/lib/mongodb\";\r\nimport { ObjectId } from \"mongodb\";\r\n\r\ninterface StudentVehicle {\r\n  _id?: ObjectId;\r\n  studentName: string;\r\n  usn: string;\r\n  hostelRoom: string;\r\n  vehicleNumber: string;\r\n  licensePlateImage: string;\r\n  registrationDate: Date;\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { db } = await connectToDatabase();\r\n    const body = await request.json();\r\n    const { studentName, usn, hostelRoom, vehicleNumber, licensePlateImage } = body;\r\n\r\n    console.log(\"[v0] Registration request received for vehicle:\", vehicleNumber);\r\n\r\n    // Validate required fields\r\n    if (!studentName || !usn || !hostelRoom || !vehicleNumber || !licensePlateImage) {\r\n      console.log(\"[v0] Missing required fields in registration\");\r\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\r\n    }\r\n\r\n    // Validate plate format\r\n    const plateValidation = validatePlate(vehicleNumber);\r\n    if (!plateValidation.isValid) {\r\n      console.log(\"[v0] Invalid plate format:\", vehicleNumber);\r\n      return NextResponse.json(\r\n        { error: \"Invalid license plate format\", details: plateValidation.errors },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    const normalizedPlate = normalizePlateNumber(vehicleNumber);\r\n\r\n    // Check if vehicle already registered\r\n    const existingVehicle = await db.collection(\"vehicles\").findOne({ vehicleNumber: normalizedPlate });\r\n\r\n    if (existingVehicle) {\r\n      console.log(\"[v0] Vehicle already registered:\", normalizedPlate);\r\n      return NextResponse.json({ error: \"Vehicle already registered\" }, { status: 409 });\r\n    }\r\n\r\n    // Validate student data\r\n    if (!usn.match(/^[0-9]{1}[A-Z]{2}[0-9]{2}[A-Z]{2}[0-9]{3,4}$/)) {\r\n      console.log(\"[v0] Invalid USN format:\", usn);\r\n      return NextResponse.json({ error: \"Invalid USN format\" }, { status: 400 });\r\n    }\r\n\r\n    // Create new record\r\n    const newRecord: StudentVehicle = {\r\n      studentName,\r\n      usn: usn.toUpperCase(),\r\n      hostelRoom,\r\n      vehicleNumber: normalizedPlate,\r\n      licensePlateImage,\r\n      registrationDate: new Date(),\r\n    };\r\n\r\n    const result = await db.collection(\"vehicles\").insertOne(newRecord);\r\n    newRecord._id = result.insertedId as ObjectId;\r\n\r\n    console.log(\"[v0] Vehicle registered successfully:\", normalizedPlate);\r\n    console.log(\"[v0] Total registrations:\", await db.collection(\"vehicles\").countDocuments());\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: true,\r\n        message: \"Vehicle registered successfully\",\r\n        data: newRecord,\r\n      },\r\n      { status: 201 },\r\n    );\r\n  } catch (error) {\r\n    console.error(\"[v0] Registration error:\", error);\r\n    return NextResponse.json({ error: \"Failed to register vehicle\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  return NextResponse.json({\r\n    message: \"Vehicle Registration API\",\r\n    method: \"POST\",\r\n    description: \"Register a new student vehicle\",\r\n  });\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAaO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,0MAAiB;QACtC,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,WAAW,EAAE,GAAG,EAAE,UAAU,EAAE,aAAa,EAAE,iBAAiB,EAAE,GAAG;QAE3E,QAAQ,GAAG,CAAC,mDAAmD;QAE/D,2BAA2B;QAC3B,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,cAAc,CAAC,iBAAiB,CAAC,mBAAmB;YAC/E,QAAQ,GAAG,CAAC;YACZ,OAAO,qNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,wBAAwB;QACxB,MAAM,kBAAkB,IAAA,iNAAa,EAAC;QACtC,IAAI,CAAC,gBAAgB,OAAO,EAAE;YAC5B,QAAQ,GAAG,CAAC,8BAA8B;YAC1C,OAAO,qNAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAgC,SAAS,gBAAgB,MAAM;YAAC,GACzE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,kBAAkB,IAAA,oNAAoB,EAAC;QAE7C,sCAAsC;QACtC,MAAM,kBAAkB,MAAM,GAAG,UAAU,CAAC,YAAY,OAAO,CAAC;YAAE,eAAe;QAAgB;QAEjG,IAAI,iBAAiB;YACnB,QAAQ,GAAG,CAAC,oCAAoC;YAChD,OAAO,qNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,wBAAwB;QACxB,IAAI,CAAC,IAAI,KAAK,CAAC,iDAAiD;YAC9D,QAAQ,GAAG,CAAC,4BAA4B;YACxC,OAAO,qNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,oBAAoB;QACpB,MAAM,YAA4B;YAChC;YACA,KAAK,IAAI,WAAW;YACpB;YACA,eAAe;YACf;YACA,kBAAkB,IAAI;QACxB;QAEA,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,YAAY,SAAS,CAAC;QACzD,UAAU,GAAG,GAAG,OAAO,UAAU;QAEjC,QAAQ,GAAG,CAAC,yCAAyC;QACrD,QAAQ,GAAG,CAAC,6BAA6B,MAAM,GAAG,UAAU,CAAC,YAAY,cAAc;QAEvF,OAAO,qNAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS;YACT,MAAM;QACR,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,qNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClF;AACF;AAEO,eAAe;IACpB,OAAO,qNAAY,CAAC,IAAI,CAAC;QACvB,SAAS;QACT,QAAQ;QACR,aAAa;IACf;AACF"}}]
}